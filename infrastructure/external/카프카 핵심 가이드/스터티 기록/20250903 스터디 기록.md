## 요약 정리
한개의 서버 안에 카프카 1개 안에 3개의 브로커가 떠있다고 하면 -> 한개의 브로커라고 보면 된다 <br>

토픽, 파티션 개념 정리 <br>

레플리카는 토픽기준이 아닌, 파티션 기준으로 복제가 된다 <br>
in.sync.replicas 옵션을 기준으로 복제가 된다 <br>
- 브로커가 3개고, 레플리카가2개면 복제는 브로커1,2 만 되고, 브로커3은 리더가 아닌 이상 복제가 되지 않는다 <br>


broker 복제 메커니즘 정리 <br>
쓰기 작업 기준
```text
java// acks=all
1. Producer → Leader 전송 (동기)
2. Leader → 로컬 기록 (동기)
3. Leader → ISR 팔로워들에게 복제 (병렬 동기)
4. 팔로워들 → 기록 완료 후 ACK (동기)
5. Leader → Producer 응답 (동기)

// 전체 과정이 동기적으로 완료된 후에야 Producer가 성공 응답 받음
```


읽기 작업
```text
java// Consumer는 항상 리더에서만 읽기
1. Consumer → 리더 파티션에서만 fetch
2. 팔로워에서는 읽기 불가 (일반적인 경우)
3. 리더 장애 시 새 리더 선출 후 읽기 계속
   백그라운드 복제
   java// 팔로워가 능동적으로 리더 추적
1. 팔로워 → 리더에게 지속적 fetch 요청 (폴링)
2. 리더 → 새 메시지가 있으면 팔로워에게 전송
3. 팔로워 → 로컬 기록 후 offset 업데이트
4. 지연 시 ISR에서 제외, 복구 시 다시 포함
```
