# 로드밸런서/방화벽: 4계층 장비(세션 장비)
4계층 장비는 TCP 와 같은 4계층 헤더에 있는 정보를 이해하고 이 정보들을 기반으로 동작한다 <br>
4계층 프로토콜 동작에 대한 깊은 이해 없이 4계층 장비를 2,3계층 네트워크 장비처럼 설계, 운용하면 여러 가지 문제가 발생한다 <br>

4계층 이상에서 동작하는 로드 밸런서, 방화벽과 같은 장비를 '세션 장비' 라고 부르기도 한다 <br>

### 로드 밸런서
서버나 장비의 부하를 분산하기 위해 사용하는 장비를 보통 로드 밸런서라고 부른다 <br>
트래픽을 분배해주는 기능이 있어, 웹 서버의 부하 분산에서 자주 사용이 된다 <br>

사용자 천명의 요청을 동시에 처리해주는 서버보다, 사용자 5천명의 요청을 동시에 처리해주는 서버의 비용은 <br>
5배가 아니라 10배 이상 비싸다 <br>

그래서 큰 장비를 조금 쓰는게 아닌, 작은 장비 여러대를 묶어 사용하는 방법을 사용한다 <br>
이런 시스템 확장 방법을 스케일 아웃 이라고 하며 개념적으로 **스케일 업, 스케일 아웃** 이라는 것이 있다 <br>

작은 시스템 여러 대를 운영하더라도 사용자는 서버 배치와 상관없이 하나의 서비스로 보여야 하는데 당연하다 <br>
로드밸런서가  서비스에 사용되는 대표 IP 주소를 서비스 IP로 갖고 그 밑에 시스템이 늘어나면 로드 밸런서가 각 시스템의 실제 IP로 변경해 요청을 보낸다 <br>
ex) User -> 로드밸런서 -> 서버 <br>

로드 밸런서는 동작하는 계층에 따라 보통 4계층 과 7계층으로 나뉜다 <br>

- L4 로드 밸런싱
  - 일반적인 로드밸런서가 동작하는 방식이다
  - TCP,UDP 정보를 기반으로 로드밸런싱을 한다.

- L7 로드 밸런싱
  - http,ftp,smtp 같은 애플리케이션 프로토콜 정보를 기반으로 로드 밸런싱을 수행한다.
  - http 헤더 정보, Uri 정보 기반으로 부하 분산을 할 수 있다
  - 엔진엑스에 리버스 프록시와 유사한 기능을 가지고 있다.

네트워크 쪽에서는 L4 로드밸런싱, 어플리케이션 단에서는 L7 로드밸런싱 컴포넌트를 사용한다 <br>

### L4 스위치
L4 스위치는, 4계층에 동작하면서 로드 밸런서 기능이 있는 스위치 이다 <br>
내부 동작 방식은 4계층 로드 밸런서 이지만, 외형은 스위치처럼 여러 개의 포트를 가지고 있다 <br>

#### ADC
ADC 는 애플리케이션 계층에서 동작하는 로드 밸런서 이다 <Br>
4계층 로드밸런서와 달리 어플리케이션 프로토콜의 헤더와 내용을 이해하고 동작하여, 다양한 부하 분산, 정보 필터링 등이 가능하다 <br>

#### 스케일 업 & 스케일 아웃
시스템이 갑자기 커졌을 떄 가장 쉽게 확장하는 방법은 서비스 용량을 키우는 방법이다. 이게 바로 스케일 업 이다 <br>
파일 저장소는 보통 크게 확장할 수 있지만, cpu, 메모리를 확장하기는 쉽지 않다 <br>

애초에 스케일 업을 고려해 CPU 여러 개를 꽂을 수 있고, 메모리를 많이 가진 보드를 구매해야 하는데 이 경우 비용이 많이 나간다 <br>
이러한 문제들 때문에 가능하면 스케일 아웃을 이용해 시스템 용량을 높인다 <br>

스케일 업은 서버 1개를 크게 키우는 것이고, 스케일 아웃은 같은 성능을 작은 서버를 여러개 생성하는 것이다 <br>
즉 스케일 아웃은 시스템을 병렬로 운영하는 방법이다 <br>

물론 스케일 아웃을 위해 새로 시스템 설계를 하거나 분산을 위한 별도의 프로세스를 운영하거나 로드 밸런서와 같이 부하를 분산해주는 별도의 외부 시스템이 필요하다 <br>

위와 반대 개념으로 큰 서비스를 축소 시켜야 할 떄가 있다 <br>
**스케일 다운, 스케일 인 이 있다.<br>**

스케일 다운은 스케일 업과 반대 개념이다, 즉 큰 1개의 서버를 작게 줄이는 것 <br>
스케일 인은 스케일 아웃 의 반대개념이다, 여러개의 서버를 다시 1개로 만드는 것 <br>

### 방화벽
네트워크 중간에 위치해 해당 장비를 통과하는 트래픽을 사전에 주어진 정책 조건에 맞춰 허용,차단 하는 장비이다 <br>

### 세션관리
세션 장비는 일반적인 2,3계층 네트워크 장비와 달리 세션을 이해하고 세션 테이블을 유지한다 <br>
세션 테이블 정보를 이용해 패킷을 변경하거나 애플리케이션 성능을 최적화 및 보안을 강화할 수 있다 <br>