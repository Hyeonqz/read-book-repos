# 1장 - 카프카란 무엇인가?
## 카프카의 동작 방식과 원리
카프카는 기본적으로 메시징 서버로 동작합니다 <br>
메시지라고 불리는 데이터 단위를 보내는 측 '**producer**' 에서 카프카에 토픽이라는 각각의 메시지 저장소에 데이터를 저장하면 <br>
메시지를 읽는 '**consumer**' 가 원하는 토픽(메시지 저장소) 에서 데이터를 가져가게 되어있다 <br>

> 중앙에 메시징 시스템 서버를 두고 이렇게 메시지를 보내고 받는 형태의 통신을 pub/sub 모델이라고 한다 <br>
기본적으로 pub/sub 은 비동기 메시징 전송 방식으로서, 메시지를 발행하는 producer 는 누가 읽을지 정하지 않고 메시지를 발행한다 <br>
그리고 구독을 신청해는 consumer 만이 정해진 메시지를 받을 수 있다 <br>
또한 consumer 는 발신자 정보가 없어도 원하는 메시지만을 수신할 수 있다.

프로듀서가 메시지를 직접 컨슈머에게 전달하지 않고 메시지 전송 브로커인 카프카에게 전달한다 <br>
이때 프로듀서는 메시지 내용과 메시지 받을 사람의 정보를 브로커에게 전달한다 <br>
그리고 카프카 브로커가 메시지의 내용과 정보를 확인하고 컨슈머들의 큐에 전달한다 <br>

컨슈머는 자신들의 큐를 모니터링하다가 큐에 메시지가 전달되면 이 값을 가져간다 <br>

위 시스템의 장점은 어떠한 서버에 장애가 생겨도, 메시징 시스템만 살아 있으면 프로듀서가 발행한 메시지가 유실되지 않는다 <br>
다만 pub/sub 의 단점은 직접 통신을 하지 않기 때문에 메시지가 정확히 전달되었는지 확인하기 위해 코드가 좀더 복잡해지고 <br>
중간에 브로커를 한번 거쳐서 가기 때문에 메시지 전달 속도가 엄청 빠르지는 않다는 점 입니다 <br>

기존의 메시징 시스템은 메시지의 보관, 교환, 전달 과정에서 신뢰성을 보장하는 것에 중점을 맞췄기 때문에 속도와 용량은 그렇게 중요하지는 않았습니다 <br>

카프카는 메시징 시스템이 지닌 성능의 단점을 극복하기 위해, 메시지 교환 전달의 신뢰성 관리를 프로듀서와 컨슈머 쪽으로 넘기고, 부하가 많이 걸리는 교환기 기능 역시 컨슈머가 만들 수 있게 함으로써 메시징 시스템 내에서의 작업량을 줄였다 <br>
위에서 절약한 태스크를 메시징 전달 성능에 집중시켜서 고성능 메시징 시스템을 만들어 냈다 <br>

1) 프로듀서는 새로운 메시지를 브로커(카프카) 에게 보낸다
2) 프로듀서가 보낸 메시지는 카프카에 토픽에 저장이 된다.
3) 컨슈머는 카프카 서버에 접속하여 새로운 메시지를 가져간다.

-> 기본 동작은 '비동기' 로 동작을 한다 <br>
프로듀서는 컨슈머와 관계없이 새로운 메시지를 카프카로 전송하고, 컨슈머 역시 프로듀서와 관계없이 카프카에서 새로운 메시지를 가져온다 <br>
카프카에는 수 많은 메시지들이 저장되고, 그 메시지들은 토픽이라는 식별자를 이용해 토픽 단위로 저장되고 있다.


## 카프카의 특징
어느 부분에서 RabbitMQ 와 다를까? <br>

#### 프로듀서와 컨슈머의 분리
웹 상에서 카프카를 사용하지 않았을 떄는 scale-out 또한 불편하다 <br>
웹 서버 또는 WAS 가 추가되었을 때 카프카로 메시지를 보내고 가져가는 식으로 설계가 된다면 서버 추가에 대한 부담도 많이 사라질 것으로 생각된다 <br>


#### 멀티 프로듀서, 멀티 컨슈머
카프카는 하나의 토픽에 여러 프로듀서 또는 여러 컨슈머가 접근 가능한 구조로 되어있습니다 <br>
하나의 프로듀서가 하나의 토픽에만 메시지를 보내는 것이 아니라, 하나 또는 하나 이상의 토픽으로 메시지를 보낼 수 있다 <br>
컨슈머 또한 하나의 토픽에서만 메시지를 가져오는 것이 아니라, 하나 또는 하나 이상의 토픽으로부터 메시지를 가져올 수 있다 <br>

위 구조를 통해서 중앙 집중형 구조로 구성할 수 있다 <br>

#### 디스크에 메시지 저장
카프카가 기존의 메시지큐와 다른 점은 바로 디스크에 메시지를 저장하고 유지하는 것이다 <br>
다른 메시징 큐는 메시지를 읽으면 큐에서 바로 메시지를 삭제한다 <br>
하지만 카프카는 일정 주기동안 디스크에 메시지를 저장해둔다 <br>

트래픽이 일시적으로 폭주해도 카프카의 디스크에 안전하게 보관되어 있기 때문에 메시지가 유실될 걱정은 안해두 된다 <br>

#### 확장성
카프카는 확장이 매우 용이하다 <br>
기본적인 카프카 클러스터는 3대의 브로커로 시작해 수십 대의 브로커로 확장 가능하다 <br>
또한 확장 작업은 카프카 서비스의 중단 없이 온라인 상태에서 작업이 가능하다 <br>

#### 높은 성능
카프카는 고성능 유지하기 위해 내부적으로 분산 처리, 배치 처리 등 다양한 기법을 사용하고 있다 <br>

- 브로커: 카프카 어플리케이션이 설치되어 있는 서버 또는 노드를 의미
- 토픽: 프로듀서와 컨슈머들이 카프카로 보낸 메시지를 구분하기 위한 이름
- 파티션: 병렬처리가 가능하도록 토픽을 나누고, 많은 양의 메시지 처리를 위해 파티션의 수를 늘려줄 수있음
- 프로듀서: 메시지 생산하여 카프카로 보냄
- 컨슈머: 카프카에서 메시지를 읽어온다.

